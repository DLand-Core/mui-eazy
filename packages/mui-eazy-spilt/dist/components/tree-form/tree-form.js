import{__assign as e,__awaiter as r,__rest as t,__generator as n}from"../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.9.6_tslib@2.6.2_typescript@5.3.3/node_modules/tslib/tslib.es6.js";import{j as o}from"../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{Box as i}from"@mui/material";import{useMemo as s,useRef as a,useEffect as u,useState as l}from"react";import{useFields as m}from"../../hooks/use-fields.js";import{useResponsive as c}from"../../hooks/use-responsive.js";import d from"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/cloneDeep.js";import{processRecordLoop as f,Tree as p}from"../tree/tree.js";import _ from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Unstable_Grid2/Grid2.js";import v from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Card/Card.js";import h from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/CardHeader/CardHeader.js";import j from"../../node_modules/.pnpm/@mui_lab@5.0.0-alpha.142_@emotion_react@11.5.0_@emotion_styled@11.6.0_@mui_material@5.15.5_@t_qlw3gtmosftpd3vouevelhzhaq/node_modules/@mui/lab/LoadingButton/LoadingButton.js";var g=function(e){var r=e.formRef,t=e.id,n=e.formConfig,o=m(n,{formId:t}),i=o.formNode,s=o.methods;return u((function(){r.current[t]=s}),[]),i},x=function(e,r){r&&Object.entries(e).forEach((function(e){var t=e[0],n=e[1];"checkbox"==n.type?n.defaultValue=!!r[t]:n.defaultValue=r[t]||n.defaultValue||""}))},y=function(r){var n=r.value,o=void 0===n?{}:n,i=r.transfer,a=r.baseData,u=s((function(){if(o&&Object.values(o).length){o=i(d(o));var r=function(n,o){(null==n?void 0:n.formConfig)&&x(null==n?void 0:n.formConfig,o),n.sections&&n.sections.forEach((function(n){var i=o[n.name];"array"!==n.type?i&&r(n,i):(n.sections=[],Array.isArray(i)&&i.forEach((function(r){var o,i=n.formCreater(),s=i.formConfig,a=t(i,["formConfig"]);r&&x(s,r);var u=e(e({},a),{active:!1,formConfig:s,onDelete:function(e,r){var t=r.findIndex((function(r){return r.id==e}));r.splice(t,1)}});null===(o=n.sections)||void 0===o||o.push(u)})))}))};r(a,o)}return a}),[o,a]);return u};function b(t){var m=this,d=t.handleClick,x=t.treeConfig,b=t.actionBtnArr,C=t.transferResult,E=t.transferInput,k=t.value,w=c("up","md"),D=a({}),I=y({value:k,transfer:E,baseData:x});u((function(){S.current=I,B()}),[I]);var S=a(I),O=l(I),R=O[0],V=O[1],A=s((function(){var e={};return f(S.current,"0",e),e}),[R]),B=function(){V(e({},S.current))},F=o.jsxs(o.Fragment,{children:[w&&o.jsx(_,{md:4,children:o.jsx(p,{record:A,update:B,treeRoot:R})}),o.jsx(_,{xs:12,md:8,children:o.jsxs(v,{children:[!w&&o.jsx(h,{title:"Details"}),Object.values(A).map((function(e){var r=e.isCurrent;return o.jsx(i,{style:r?{}:{display:"none"},children:e.formConfig&&o.jsx(g,{formRef:D,id:e.id,formConfig:e.formConfig})},e.id)}))]})})]}),q=o.jsxs(o.Fragment,{children:[w&&o.jsx(_,{md:4}),o.jsxs(_,{xs:12,md:12,sx:{display:"flex",alignItems:"center"},children:[o.jsx(i,{sx:{flex:1}}),b.map((function(e,t){return o.jsx(j,{sx:{mr:2},onClick:function(){return r(m,void 0,void 0,(function(){var t,o,i;return n(this,(function(s){switch(s.label){case 0:return[4,r(m,void 0,void 0,(function(){var e,r,t,o,i,s,a,u,l,m;return n(this,(function(n){switch(n.label){case 0:for(s in r=function(e,t,n){var o;void 0===n&&(n=0);var i=D.current[n];if(i)for(var s in Object.assign(e,i.getValues()),t.formConfig)t.formConfig[s].isNotInForm&&"array"!==t.type&&"object"!==t.type&&delete e[s];(null===(o=t.sections)||void 0===o?void 0:o.length)&&t.sections.forEach((function(t){var n;if("array"==t.type){var o=e[t.name||t.label]=[];null===(n=t.sections)||void 0===n||n.forEach((function(e){var t={};r(t,e,e.id),o.push(t)}))}else{if(t.judeShow&&!t.judeShow())return;var i=e[t.name||t.label]={};r(i,t,t.id)}}))},r(e={},R),t=!0,i=[],o=A)i.push(s);a=0,n.label=1;case 1:return a<i.length?(s=i[a])in o?(u=s,D.current[u]?[4,null===(m=D.current[u])||void 0===m?void 0:m.trigger()]:[3,3]):[3,3]:[3,4];case 2:l=n.sent(),A[u].isError=!l,l||(t=!1),B(),n.label=3;case 3:return a++,[3,1];case 4:return null==C||C(e),[2,{isSuccess:t,result:e}]}}))}))];case 1:return t=s.sent(),o=t.isSuccess,i=t.result,d({type:e.name,isSuccess:o,result:i}),[2]}}))}))},type:"submit",variant:"contained",size:"large",children:e.name},t)}))]})]});return o.jsxs(_,{container:!0,children:[F,q]})}export{b as TreeForm,x as setDefault,y as useCreateTreeData};
