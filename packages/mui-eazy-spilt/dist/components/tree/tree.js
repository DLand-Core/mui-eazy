import{__rest as i,__assign as o}from"../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.9.6_tslib@2.6.2_typescript@5.3.3/node_modules/tslib/tslib.es6.js";import{j as t}from"../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{Box as e,IconButton as n,Collapse as r}from"@mui/material";import{useRef as d,useState as l}from"react";import{uuidv4 as a}from"../../utils/uuidv4.js";import{TreeItem as c}from"./tree-item.js";import{Iconify as s}from"../iconify/iconify.js";var u=function(e){var d,a,p=e.isAdd,v=e.parentSections,f=e.record,m=e.sections,h=e.update,j=e.onDelete,x=e.onAdd,w=e.judeShow,_=i(e,["isAdd","formConfig","parentSections","isCurrent","record","sections","update","onDelete","onAdd","judeShow"]),S=l(!0),g=S[0],y=S[1];return w&&!w()?t.jsx(t.Fragment,{}):t.jsxs(t.Fragment,{children:[t.jsxs(c,o({onClick:function(){var i;if(e.formConfig){for(var o in f)f[o].active=!1,f[o].isCurrent=!1;f[e.id].active=!0,f[e.id].isCurrent=!0;var t=(null===(i=e.id)||void 0===i?void 0:i.split("_").slice(0,-1))||[];(null==t?void 0:t.length)>1&&t.forEach((function(i,o){var t,n=null===(t=e.id)||void 0===t?void 0:t.split("_").slice(0,o+1).join("_");n&&"0"!=n&&(f[n].active=!0)})),null==h||h()}else if(e.onSwitch){for(var o in f)f[o].active=!1,f[o].isCurrent=!1;f[e.id].active=!0,f[e.id].isCurrent=!0,e.onSwitch(e.id)}"0"==e.id?y(!0):m&&y(!g)}},_,{children:[p&&t.jsx(n,{style:{zIndex:10},onClick:function(i){i.stopPropagation(),e.active||y(!0),m&&x(m),null==h||h()},sx:{position:"absolute",right:"40px"},children:t.jsx(s,{width:16,icon:"icon-park-outline:add"})}),"array"==(null===(a=f[null===(d=e.id)||void 0===d?void 0:d.split("_").slice(0,-1).join("_")])||void 0===a?void 0:a.type)&&t.jsx(n,{style:{zIndex:10},onClick:function(i){if(i.stopPropagation(),f[e.id].active){for(var o in f)f[o].active=!1;f[0].active=!0}j(e.id,v),null==h||h()},sx:{position:"absolute",right:"40px"},children:t.jsx(s,{width:16,icon:"icon-park-outline:delete"})}),!!m&&"0"!==e.id&&t.jsx(s,{width:16,icon:g?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill",sx:{position:"absolute",right:"20px"}})]})),!!m&&t.jsx(r,{in:g,children:null==m?void 0:m.map((function(n,r){var d,l=n.label,a=n.parentId,c=n.onDelete,s=i(n,["label","parentId","onDelete"]);return t.jsx("div",{children:t.jsx(u,o({onSwitch:e.onSwitch,onDelete:c,parentSections:c?m:null,update:h,record:f},s,{label:"array"==(null===(d=f[a])||void 0===d?void 0:d.type)?"".concat(l,"-").concat(r):l}))},n.id)}))})]})},p=function(i,o,t){o||(o=a()),"0"==o&&(t[o]=i),i.id=o;var e=i.sections;e&&e.map((function(i){i.parentId=o;var e=i.id||"".concat(o,"_").concat(a());p(i,e,t),t[e]=i}))},v=function(n){var r=n.treeRoot,a=n.update,c=n.record,s=n.onSwitch,v=i(n,["treeRoot","update","record","onSwitch"]),f=r,m=c,h=d({}),j=l(Date.now())[1];return c||(m=h.current,p(f,"0",m)),t.jsx(e,o({},v,{children:t.jsx(u,o({onSwitch:function(i){null==s||s(i,m),j(Date.now())},update:a,record:m},f))}))};export{v as Tree,p as processRecordLoop};
