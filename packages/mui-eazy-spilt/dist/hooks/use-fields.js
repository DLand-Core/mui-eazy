import{__spreadArray as o,__assign as e,__awaiter as r,__generator as i}from"../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.9.6_tslib@2.6.2_typescript@5.3.3/node_modules/tslib/tslib.es6.js";import{j as t}from"../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{yupResolver as n}from"../node_modules/.pnpm/@hookform_resolvers@3.3.1_react-hook-form@7.45.4/node_modules/@hookform/resolvers/yup/dist/yup.js";import{Stack as a}from"@mui/material";import s,{useState as l,useMemo as u}from"react";import{useForm as m}from"../node_modules/.pnpm/react-hook-form@7.45.4_react@18.2.0/node_modules/react-hook-form/dist/index.esm.js";import*as d from"yup";import{uuidv4 as c}from"../utils/uuidv4.js";import{useGetField as f}from"./use-get-field.js";import p from"../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/styles/styled.js";import v from"../node_modules/.pnpm/@mui_lab@5.0.0-alpha.142_@emotion_react@11.5.0_@emotion_styled@11.6.0_@mui_material@5.15.5_@t_qlw3gtmosftpd3vouevelhzhaq/node_modules/@mui/lab/LoadingButton/LoadingButton.js";import _ from"../components/form/form-provider.js";var h=p(v)((function(){return{backgroundColor:"rgba(34, 197, 94, 0.16)",color:"#118D57","&:hover":{backgroundColor:"rgba(34, 197, 94, 0.36)"}}}));function g(p,v){var g=this;void 0===v&&(v={});var b=v.onSubmit,j=v.formPrefix,y=void 0===j?"":j,x=v.sx,C=void 0===x?{}:x,k=v.mode,w=void 0===k?"onChange":k,S={},q=l("0"),F=q[0],O=q[1],R=u((function(){return p}),[p]),E={};Object.entries(R).forEach((function(e){var r=e[0],i=e[1],t=i.schema,n=i.defaultValue,a=void 0===n?"":n,s=i.name,l=void 0===s?r:s,u=i.prefix,m=void 0===u?y?[y]:"":u,c=i.fieldConfig,f=l,p=(void 0===c?{}:c).required;if(m){var v="";v=Array.isArray(m)?o([],m,!0).join("."):m,S[v]||(S[v]={}),S[v][f]=a}else{var _=E,h=S,g=f.split(".");g.forEach((function(o,e){e!=g.length-1?(h[o]||(_[o]={},h[o]={}),_=_[o],h=h[o]):(h[o]=a,t?_[o]=t:p&&(_[o]=d.string().required(l+" is required")))}))}}));var V=function(o,r,i){void 0===i&&(i=null);var t=e({},o);for(var n in t)"object"!=typeof t[n]||t[n]instanceof d.Schema||V(t[n],r?r+"."+n:n,t);if(r){var a=r.split(".");a.length>1?i[a.slice(-1)[0]]=d.object(t):E[a.slice(-1)[0]]=d.object(t)}};V(E,"",E);var z=d.object().shape(E),A=m({resolver:n(z),defaultValues:S,mode:w}),B=A.watch,L=A.handleSubmit,D=A.formState.isSubmitting,N=f(A),P=u((function(){return Object.entries(R).map((function(o){var r,i=o[0],n=o[1];return"custom"==n.type?(null===(r=n.customForm)||void 0===r?void 0:r.call(n))||t.jsx(t.Fragment,{}):t.jsx(s.Fragment,{children:N(n.name||i,e({prefix:y?[y]:""},n))},i)}))}),[F,R]);s.useEffect((function(){var o=B((function(o,e){Object.entries(R).map((function(r){var i,t,n,a,s=r[1];if(null===(i=s.fieldConfig)||void 0===i?void 0:i.childFieldConfig)for(var l=0,u=Object.values(null===(t=s.fieldConfig)||void 0===t?void 0:t.childFieldConfig);l<u.length;l++){var m=u[l];m.watch&&(null===(n=m.watch)||void 0===n||n.call(m,{currentConfig:m,values:o,info:e,api:A}),O(c()))}s.watch&&(null===(a=s.watch)||void 0===a||a.call(s,{currentConfig:s,values:o,info:e,api:A}),O(c()))}))}));return function(){return o.unsubscribe()}}),[B,R]);var G=u((function(){return t.jsx(_,{onSubmit:L((function(){})),formRef:A,children:t.jsxs(a,{sx:C,spacing:3,children:[P,b&&t.jsx(h,{type:"submit",variant:"contained",size:"large",onClick:function(){return r(g,void 0,void 0,(function(){var o;return i(this,(function(e){switch(e.label){case 0:return[4,A.trigger()];case 1:return o=e.sent(),b({isRight:o,values:A.getValues(),formRef:A}),[2]}}))}))},loading:D,children:"Save"})]})})}),[F,P]);return{formNode:G,methods:A}}export{g as useFields};
